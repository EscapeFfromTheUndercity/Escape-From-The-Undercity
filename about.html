<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>About - Escape from the Undercity</title>
  <style>
    body{background:#000;color:#fff;font-family:monospace;margin:0}
    header{text-align:center;display:flex;flex-direction:column;align-items:center;padding-top:40px}
    h1{font-size:2.5rem}
    nav{margin-top:10px}
    nav a{color:#fff;font-size:1rem;margin:0 10px;text-decoration:none}
    nav a:hover{text-decoration:underline}
    @media(min-width:600px){nav a{font-size:1.6rem;padding:8px 14px}}
    main{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding-top:60px;min-height:calc(100vh - 120px)}
    .content{margin:0 auto;width:90%;max-width:800px;line-height:1.8;text-align:left;font-size:1rem}
    .content p{color:yellow;animation:glowFlash 6s infinite ease-in-out}
    @keyframes glowFlash{0%{text-shadow:none}50%{text-shadow:0 0 10px yellow,0 0 20px yellow}100%{text-shadow:none}}
    @media(min-width:768px){.content{font-size:1.3rem;line-height:2}}

    /* Typewriter caret */
    .caret::after{
      content:"â–Œ";
      display:inline-block;
      animation:blink 1s steps(1,end) infinite;
      margin-left:2px;
    }
    @keyframes blink{50%{opacity:0}}
    @media (prefers-reduced-motion: reduce){
      .content p{animation:none}
      .caret::after{animation:none}
    }
  </style>
</head>
<body style="background:#000;color:#fff">
  <header>
    <h1>Escape from the Undercity</h1>
    <nav>
      <a href="index.html">Home</a> |
      <a href="comic.html">Comic</a> |
      <a href="about.html">About</a> |
      <a href="shop.html">Shop</a>
    </nav>
  </header>

  <main>
    <div class="content" id="about-typed" aria-live="polite"></div>
  </main>

  <!-- Music -->
  <audio id="bgm" loop preload="auto">
    <source src="escape_loop_theme_9_Aug_25.ogg" type="audio/ogg">
    Your browser does not support the audio element.
  </audio>

  <!-- Toggle button -->
  <button id="musicToggle" aria-pressed="true"
    style="position:fixed;left:50%;bottom:22px;transform:translateX(-50%);font-family:monospace;font-size:1rem;background:#222;color:#fff;border:1px solid #555;padding:10px 18px;cursor:pointer;border-radius:6px;z-index:10">
    ðŸ”Š Music: On
  </button>

  <script>
    // --- Music toggle (unchanged) ---
    const audio = document.getElementById('bgm');
    const btn   = document.getElementById('musicToggle');
    const KEY = 'siteBgmPref';
    const pref = localStorage.getItem(KEY);
    function setButton(isOn){
      btn.textContent = isOn ? 'ðŸ”Š Music: On' : 'ðŸ”‡ Music: Off';
      btn.setAttribute('aria-pressed', isOn ? 'true' : 'false');
    }
    async function startMusic(){
      if (pref === 'off'){ setButton(false); return; }
      try{ await audio.play(); setButton(true); localStorage.setItem(KEY,'on'); }
      catch{ setButton(false); }
    }
    btn.addEventListener('click', async ()=>{
      if (audio.paused){
        try{ await audio.play(); setButton(true); localStorage.setItem(KEY,'on'); }catch{}
      }else{
        audio.pause(); setButton(false); localStorage.setItem(KEY,'off');
      }
    });
    document.addEventListener('DOMContentLoaded', startMusic);

    // --- Typewriter effect ---
    (function () {
      const container = document.getElementById('about-typed');
      const batches = [
        [
          "It's all coming back to him now.....",
          "H's girlfriend Jane kept insisting, that if they were to be together, he had to address his 'negativity' and 'paranoia'."
        ],
        [
          "He harboured deep misgivings about the City, its Society, and especially its Government.  But Jane was adamant - and very attractive.  So H made an appointment with the City Mental Resilience Support Team.  At least he could tell Jane he'd been.",
          "H awakes in a room, amidst a pile of mostly dead bodies, with deadly robots entering to dispose of the remains."
        ],
        [
          "Now you're getting it H!  You weren't paranoid enough, and instead listened to a fool.  Big mistake.  And whatfor the Hippocratic Oath and Patient Consent?",
          "Award Winning Comix Artist Richard Cowdry, with Peter Lally, bring you the future....NOW!!!"
        ]
      ];

      const typingSpeed = 18;
      const pauseBetweenBatches = 10000; // 10s
      const startDelay = 500;
      const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      function typeParagraph(text, parent, onDone){
        const p = document.createElement('p');
        parent.appendChild(p);
        if (reducedMotion){ p.textContent = text; onDone && onDone(); return; }
        let i = 0;
        (function tick(){
          p.textContent += text.charAt(i++);
          if (i < text.length){ setTimeout(tick, typingSpeed); }
          else { onDone && onDone(); }
        })();
      }

      function typeBatch(batchIndex, onDone){
        const wrap = document.createElement('div');
        wrap.classList.add('caret');
        container.appendChild(wrap);

        const [p1, p2] = batches[batchIndex];
        typeParagraph(p1, wrap, ()=> {
          typeParagraph(p2, wrap, ()=> {
            onDone && onDone(wrap);
          });
        });
      }

      function run(){
        if (reducedMotion){
          batches.flat().forEach(t=>{
            const p=document.createElement('p');
            p.textContent=t;
            container.appendChild(p);
          });
          return;
        }

        setTimeout(()=>{
          // Batch 1
          typeBatch(0, (w1)=>{
            setTimeout(()=>{
              w1.classList.remove('caret'); // remove old caret
              typeBatch(1, (w2)=>{
                setTimeout(()=>{
                  w2.classList.remove('caret'); // remove caret before final
                  typeBatch(2, (w3)=>{
                    w3.classList.remove('caret'); // no caret at the end
                  });
                }, pauseBetweenBatches);
              });
            }, pauseBetweenBatches);
          });
        }, startDelay);
      }

      run();
    })();
  </script>
</body>
</html>
