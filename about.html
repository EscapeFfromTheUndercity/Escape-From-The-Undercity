  <audio id="bgm" loop preload="auto">
    <source src="escape_loop_theme_9_Aug_25.ogg" type="audio/ogg">
    Your browser does not support the audio element.
  </audio>

  <!-- Toggle button -->
  <button id="musicToggle" aria-pressed="true">ðŸ”Š Music: On</button>

  <script>
    const audio = document.getElementById('bgm');
    const btn = document.getElementById('musicToggle');
    const pref = localStorage.getItem('aboutBgmPref'); // 'on' | 'off' | null

    function setButton(isOn) {
      btn.textContent = isOn ? 'ðŸ”Š Music: On' : 'ðŸ”‡ Music: Off';
      btn.setAttribute('aria-pressed', isOn ? 'true' : 'false');
    }

    async function startMusic() {
      if (pref === 'off') {
        // respect user choice
        setButton(false);
        return;
      }
      try {
        await audio.play();
        setButton(true);
        localStorage.setItem('aboutBgmPref', 'on');
      } catch {
        // autoplay blocked (mobile Safari, etc.)
        setButton(false);
      }
    }

    btn.addEventListener('click', async () => {
      if (audio.paused) {
        try {
          await audio.play();
          setButton(true);
          localStorage.setItem('aboutBgmPref', 'on');
        } catch {}
      } else {
        audio.pause();
        setButton(false);
        localStorage.setItem('aboutBgmPref', 'off');
      }
    });

    document.addEventListener('DOMContentLoaded', startMusic);
  </script>

